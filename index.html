<!DOCTYPE HTML><html><head><meta charset="UTF-8"><title>AquaMeter BLE</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<style>
body{font-family:-apple-system,sans-serif;background:#f0f4f8;margin:0;padding:0;color:#2c3e50;text-align:center}
.card{max-width:450px;margin:10px auto;background:#fff;padding:20px;border-radius:20px;box-shadow:0 10px 25px rgba(0,0,0,0.1)}
.tabs{display:flex;background:#eee;border-radius:12px;margin-bottom:20px;overflow:hidden}
.tab-btn{flex:1;padding:12px;border:none;background:#eee;cursor:pointer;font-weight:bold}
.tab-btn.active{background:#2196f3;color:#fff}
.tab-content{display:none}.tab-content.active{display:block}
#v-lit{font-size:2.8rem;font-weight:800;color:#2196f3;line-height:1;margin:10px 0;display:block}
.unit{font-size:0.9rem;color:#7f8c8d;font-weight:bold;margin-bottom:15px;display:block}
.prog-bg{background:#eee;border-radius:10px;height:35px;position:relative;overflow:hidden;margin:15px 0;border:1px solid #ddd}
.prog-bar{background:#2196f3;height:100%;width:0%;transition:0.8s ease-in-out}
.prog-text{position:absolute;width:100%;top:7px;font-weight:bold;font-size:1.1rem;color:#000;z-index:2;left:0;text-align:center}
.action-box{background:#f8f9fa;padding:15px;border-radius:15px;margin-top:10px;border:1px solid #f0f0f0}
button{width:100%;padding:14px;border:none;border-radius:12px;font-weight:bold;cursor:pointer;font-size:1rem;transition:0.2s}
.btn-blue{background:#2196f3;color:white}.btn-green{background:#2ecc71;color:white}.btn-orange{background:#f39c12;color:white}
#conn-status{font-size:12px;margin-bottom:10px;color:#e74c3c}
</style></head>
<body><div class="card">
    <div id="conn-status">Disconnected üî¥</div>
    <button id="btn-conn" class="btn-blue" onclick="connect()">CONNECT TO AQUAMETER</button>
    <hr style="opacity:0.1;margin:15px 0">
    <div class="tabs">
      <button class="tab-btn active" onclick="openTab('main',this)">DASH</button>
      <button class="tab-btn" onclick="openTab('sett',this)">‚öôÔ∏è</button>
    </div>
    <div id="main" class="tab-content active">
      <span id="v-lit">0.00</span><span class="unit">LITROS RESTANTES</span>
      <div class="prog-bg"><div id="bar" class="prog-bar"></div><div id="perc" class="prog-text">0%</div></div>
      <button class="btn-green" onclick="send('FULL')">DEP√ìSITO CHEIO</button>
    </div>
    <div id="sett" class="tab-content">
      <button class="btn-orange" onclick="send('CAL_START')">START CALIBRATION</button>
      <button class="btn-green" style="margin-top:10px" onclick="send('CAL_STOP')">STOP (1L)</button>
    </div>
</div>
<script>
let charTX, charRX;
async function connect() {
  try {
    const device = await navigator.bluetooth.requestDevice({
      filters: [{name: 'AquaMeter_Pro'}],
      optionalServices: ['6e400001-b5a3-f393-e0a9-e50e24dcca9e']
    });
    const server = await device.gatt.connect();
    const service = await server.getPrimaryService('6e400001-b5a3-f393-e0a9-e50e24dcca9e');
    charRX = await service.getCharacteristic('6e400002-b5a3-f393-e0a9-e50e24dcca9e');
    charTX = await service.getCharacteristic('6e400003-b5a3-f393-e0a9-e50e24dcca9e');
    await charTX.startNotifications();
    charTX.addEventListener('characteristicvaluechanged', (e) => {
      const val = new TextDecoder().decode(e.target.value).split('|');
      document.getElementById('v-lit').innerText = val[0];
      let p = (parseFloat(val[0])/parseFloat(val[1])*100);
      document.getElementById('perc').innerText = p.toFixed(1) + "%";
      document.getElementById('bar').style.width = p + "%";
    });
    document.getElementById('conn-status').innerText = "Connected üü¢";
    document.getElementById('btn-conn').style.display = 'none';
  } catch(e) { alert(e); }
}
async function send(msg) {
  if(!charRX) return;
  await charRX.writeValue(new TextEncoder().encode(msg));
}
function openTab(id,btn){document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));document.getElementById(id).classList.add('active');}
</script></body></html>
